<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Register â€” Coding Club</title>
  <style>
    :root{
      --bg:#eef; --card:#fff; --border:#e5e7eb; --ink:#111; --muted:#667;
      --primary:#2563eb; --accent:#34d399;
      --ok-bg:#DFF3C4; --ok-bd:#93C572; --ok-fg:#2F6F3E; /* dark pistachio */
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg)}
    .shell{max-width:860px;margin:16px auto;padding:0 12px}
    header.top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    h1{margin:0;font-size:22px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border:none;border-radius:999px;
         background:var(--primary);color:#fff;font-weight:700;cursor:pointer;text-decoration:none}
    .btn.ghost{background:#e5e7eb;color:var(--ink)}
    .btn.refresh{background:#0ea5e9}
    .btn.refresh.spin{animation:spin .6s linear 1}
    .btn.view{background:#111827;color:#fff}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;
          box-shadow:0 10px 24px rgba(0,0,0,.10);padding:14px}

    .hint{font-size:12px;color:var(--muted)}
    label{display:block;font-weight:600;margin:10px 0 6px}
    input,select,textarea{width:100%;padding:9px 10px;border:1px solid #cbd5e1;border-radius:10px;
                          font-size:14px;background:#f9fbff}
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}

    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #edf2f7;text-align:left;font-size:13px}
    thead th{background:#f8fafc}
    .tag{display:inline-block;background:#2563eb11;color:#2563eb;border:1px solid #2563eb33;padding:2px 8px;border-radius:999px;font-size:12px}

    /* feedback messages */
    .msg{margin-top:10px;font-size:14px;border-radius:10px;padding:10px;border:1px solid transparent}
    .msg.ok{background:var(--ok-bg);border-color:var(--ok-bd);color:var(--ok-fg);font-weight:800}
    .msg.err{color:#7f1d1d;background:#fef2f2;border-color:#fecaca;font-weight:700}

    /* Modal (popup) */
    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
    .backdrop.show{display:flex}
    .modal{width:min(860px,96vw);background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.35);overflow:hidden;border:1px solid #e5e7eb}
    .modal header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#f8fafc;border-bottom:1px solid #edf2f7}
    .modal h3{margin:0;font-size:16px}
    .modal .inner{padding:10px 14px}
    .modal .actions{display:flex;gap:10px;justify-content:flex-end;padding:10px 14px;border-top:1px solid #edf2f7;background:#fafafa}
    .btn.save{background:var(--accent);color:#053b2d}
    .btn.clear{background:#ef4444}
    .btn.close{background:#94a3b8}
    .timer{font-size:12px;color:#555;margin-left:auto}
  </style>
</head>
<body>
  <div class="shell">
    <header class="top">
      <h1>Registration</h1>
      <div class="row">
        <!-- Wilsonâ€™s Coding Club: same tab (configure the HOMEPAGE path below in JS) -->
       <a href="Wilson-Coding-Club-Page.html" class="btn ghost">Wilsonâ€™s Coding Club</a>
        <a class="btn ghost" href="comment.html" target="_blank" rel="noopener">Comment</a>
        <button id="refresh" class="btn refresh" type="button" title="Refresh list (no page reload)">â†» Refresh</button>
      </div>
    </header>

    <!-- Form -->
    <section class="card" aria-label="Register form">
      <p>Please fill in your details and click <b>Save</b>. A popup will show your record; you can Save, Clear, or Close it.</p>

      <form id="registerForm" novalidate>
        <div class="grid">
          <div>
            <label for="firstName">First Name</label>
            <input id="firstName" name="firstName" placeholder="John" required>
          </div>
          <div>
            <label for="lastName">Last Name</label>
            <input id="lastName" name="lastName" placeholder="Doe" required>
          </div>
          <div>
            <label for="studentId">Student ID</label>
            <input id="studentId" name="studentId" placeholder="e.g., 123456" required
                   pattern="^[A-Za-z0-9-_.]{2,}$"
                   title="At least 2 characters; letters, numbers, dash, underscore, dot allowed.">
          </div>
          <div>
            <label for="grade">Grade</label>
            <select id="grade" name="grade" required>
              <option value="" selected disabled>Select grade</option>
              <option>6</option><option>7</option><option>8</option>
              <option>9</option><option>10</option><option>11</option><option>12</option>
            </select>
          </div>
          <div class="full" style="grid-column:1/-1">
            <label for="email">Email</label>
            <input id="email" name="email" placeholder="name@example.com" required inputmode="email">
          </div>
        </div>

        <label for="message" style="margin-top:8px">Message (optional)</label>
        <textarea id="message" name="message" placeholder="Your note..."></textarea>

        <div class="row">
          <button type="submit" class="btn" id="saveBtn">Save</button>
          <button type="reset" class="btn ghost">Reset</button>
        </div>
        <div class="hint" style="margin-top:6px">Data is stored locally in your browser using <code>localStorage</code>.</div>

        <div id="feedback" class="msg" aria-live="polite"></div>
      </form>
    </section>

    <!-- View registrations (only LAST record) -->
    <div class="row" style="justify-content:center;margin:10px 0 6px">
      <button id="toggleList" class="btn view" type="button" aria-controls="listSection" aria-expanded="false">
        View last registration
      </button>
    </div>

    <!-- List (hidden by default) -->
    <section id="listSection" class="card" aria-label="Saved registrations" style="margin-top:8px; display:none">
      <h2 style="margin:0 0 8px">
        Latest Registration <span id="count" class="tag">0 total</span>
      </h2>
      <div style="overflow:auto; max-height:45vh">
        <table aria-describedby="count">
          <thead>
            <tr>
              <th>First</th>
              <th>Last</th>
              <th>Student ID</th>
              <th>Grade</th>
              <th>Email</th>
              <th>Message</th>
              <th>Saved At</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr><td colspan="7" class="hint">No registrations yet.</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- Popup (preview) -->
  <div id="popup" class="backdrop" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
    <div class="modal">
      <header>
        <h3 id="popupTitle">Saved Record (preview)</h3>
        <span id="timer" class="timer">Auto-closing in 10sâ€¦</span>
      </header>
      <div class="inner">
        <div style="overflow:auto;max-height:50vh">
          <table style="width:100%;border-collapse:collapse">
            <thead>
              <tr style="background:#f8fafc">
                <th style="text-align:left;padding:8px;border-bottom:1px solid #eee">First</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #eee">Last</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #eee">Student ID</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #eee">Grade</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #eee">Email</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #eee">Message</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #eee">Saved At</th>
              </tr>
            </thead>
            <tbody id="popupBody">
              <tr><td colspan="7" class="hint" style="padding:10px">No data</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="actions">
        <button id="popupClear"  class="btn clear">Clear</button>
        <button id="popupSave"   class="btn save">Save</button>
        <button id="popupClose"  class="btn close">Close</button>
      </div>
    </div>
  </div>

  <script>
    // === CONFIG ===
    // Set this to the file of your blue Coding Club card page (the page in your screenshot).
    // If that page is named "login.html" in your project, set 'login.html'.
    // If you saved it as "coding-club.html", set that instead:
    //const HOMEPAGE = 'coding-club.html';  // <-- change this to your exact file name

    const KEY = 'codingClubRegistrations';

   // const homeLink = document.getElementById('homeLink');
   // homeLink.href = HOMEPAGE;   // go back to the Coding Club page in the SAME tab

    const form = document.getElementById('registerForm');
    const tableBody = document.getElementById('tableBody');
    const countEl = document.getElementById('count');
    const feedback = document.getElementById('feedback');
    const refreshBtn = document.getElementById('refresh');
    const listSection = document.getElementById('listSection');
    const toggleListBtn = document.getElementById('toggleList');

    // Modal refs
    const popup = document.getElementById('popup');
    const popupBody = document.getElementById('popupBody');
    const btnSave = document.getElementById('popupSave');
    const btnClear = document.getElementById('popupClear');
    const btnClose = document.getElementById('popupClose');
    const timerEl = document.getElementById('timer');
    let pendingEntry = null;
    let closeTimer = null;
    let remaining = 10; // seconds

    function load(){ try { return JSON.parse(localStorage.getItem(KEY) || '[]'); } catch { return []; } }
    function save(list){ localStorage.setItem(KEY, JSON.stringify(list)); }
    function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;'}[c])); }
    function isValidEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

    // Renders ONLY the latest row into the table
    function renderLatest(){
      const rows = load();
      countEl.textContent = rows.length + ' total';
      tableBody.innerHTML = '';
      if(rows.length === 0){
        tableBody.innerHTML = '<tr><td colspan="7" class="hint">No registrations yet.</td></tr>';
        return;
      }
      const r = rows[0];  // latest only
      const d = new Date(r.ts);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${escapeHtml(r.firstName)}</td>
        <td>${escapeHtml(r.lastName)}</td>
        <td>${escapeHtml(r.studentId)}</td>
        <td>${escapeHtml(r.grade)}</td>
        <td>${escapeHtml(r.email)}</td>
        <td>${escapeHtml(r.message)}</td>
        <td>${d.toLocaleString()}</td>
      `;
      tableBody.appendChild(tr);
    }

    // Toggle list (latest only)
    toggleListBtn.addEventListener('click', ()=>{
      const isOpen = listSection.style.display !== 'none';
      if(isOpen){
        listSection.style.display = 'none';
        toggleListBtn.setAttribute('aria-expanded', 'false');
        toggleListBtn.textContent = 'View last registration';
      }else{
        renderLatest();
        listSection.style.display = 'block';
        toggleListBtn.setAttribute('aria-expanded', 'true');
        toggleListBtn.textContent = 'Hide last registration';
      }
    });

    // Open popup with preview
    function openPopup(previewRow){
      // Fill popup with the single pending record at top (show also the very latest saved if you want)
      popupBody.innerHTML = '';
      const r = previewRow;
      const d = new Date(r.ts);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="padding:8px;border-bottom:1px solid #eee">${escapeHtml(r.firstName)}</td>
        <td style="padding:8px;border-bottom:1px solid #eee">${escapeHtml(r.lastName)}</td>
        <td style="padding:8px;border-bottom:1px solid #eee">${escapeHtml(r.studentId)}</td>
        <td style="padding:8px;border-bottom:1px solid #eee">${escapeHtml(r.grade)}</td>
        <td style="padding:8px;border-bottom:1px solid #eee">${escapeHtml(r.email)}</td>
        <td style="padding:8px;border-bottom:1px solid #eee">${escapeHtml(r.message)}</td>
        <td style="padding:8px;border-bottom:1px solid #eee">${d.toLocaleString()}</td>
      `;
      popupBody.appendChild(tr);

      // 10s auto-close (auto-save if still pending)
      remaining = 10;
      timerEl.textContent = `Auto-closing in ${remaining}sâ€¦`;
      if(closeTimer) clearInterval(closeTimer);
      closeTimer = setInterval(()=>{
        remaining--;
        timerEl.textContent = `Auto-closing in ${remaining}sâ€¦`;
        if(remaining <= 0){
          if(pendingEntry){
            const rows = load();
            rows.unshift(pendingEntry);
            save(rows);
            pendingEntry = null;
            feedback.className = 'msg ok';
            feedback.textContent = 'Your information has been saved. Thank you for joining our club! We will get back to you within 24 hours. ðŸ™‚';
          }
          closePopup();
        }
      }, 1000);

      popup.classList.add('show');
    }

    function closePopup(){
      if(closeTimer) clearInterval(closeTimer);
      popup.classList.remove('show');
    }

    // Submit â†’ open popup (preview first)
    form.addEventListener('submit', (e)=>{
      e.preventDefault();

      const firstName = document.getElementById('firstName').value.trim();
      const lastName  = document.getElementById('lastName').value.trim();
      const studentId = document.getElementById('studentId').value.trim();
      const grade     = document.getElementById('grade').value;
      const email     = document.getElementById('email').value.trim();
      const message   = document.getElementById('message').value.trim();

      if(!firstName || !lastName || !studentId || !grade || !email){
        feedback.className = 'msg err';
        feedback.textContent = 'Please fill in all required fields.';
        return;
      }
      if(!isValidEmail(email)){
        feedback.className = 'msg err';
        feedback.textContent = 'Please enter a valid email address.';
        return;
      }

      pendingEntry = { id: Date.now(), firstName, lastName, studentId, grade, email, message, ts: new Date().toISOString() };
      openPopup(pendingEntry);
    });

    // Popup actions
    document.getElementById('popupSave').addEventListener('click', ()=>{
      if(!pendingEntry){ closePopup(); return; }
      const rows = load();
      rows.unshift(pendingEntry);
      save(rows);
      pendingEntry = null;
      closePopup();
      feedback.className = 'msg ok';
      feedback.textContent = 'Your information has been saved. Thank you for joining our club! We will get back to you within 24 hours. ðŸ™‚';
      renderLatest();  // ensure the latest shows when user opens the list
      form.reset();
    });

    document.getElementById('popupClear').addEventListener('click', ()=>{
      localStorage.removeItem(KEY);
      pendingEntry = null;
      closePopup();
      feedback.className = 'msg err';
      feedback.textContent = 'Please try again. â˜¹ï¸';
      form.reset();
      // collapse list since there is nothing now
      listSection.style.display = 'none';
      toggleListBtn.textContent = 'View last registration';
      toggleListBtn.setAttribute('aria-expanded', 'false');
    });

    document.getElementById('popupClose').addEventListener('click', ()=>{
      pendingEntry = null;
      closePopup();
    });

    // Fancy refresh: re-render latest if the block is open
    refreshBtn.addEventListener('click', ()=>{
      refreshBtn.classList.add('spin');
      if(listSection.style.display !== 'none') renderLatest();
      setTimeout(()=>refreshBtn.classList.remove('spin'), 650);
    });
  </script>
</body>
</html>

